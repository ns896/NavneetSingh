import{x as t,v as e,I as a,i as n,_ as i,m as s,j as o,s as l,h as r,n as c,bQ as d,bR as h,A as p}from"./icon-333959f6.js";import{S as u}from"./faceplate-switch-input-084d3f59.js";import{W as m,d as k,S as v,b,_ as f,t as g,cp as C,cj as x,dr as T,cr as w,a4 as y,j as A,ds as E,a5 as M,dt as S}from"./shell-010f89b8.js";import{l as $,L as D}from"./list-item-d89a1548.js";import{T as V,a as O}from"./faceplate-textarea-input-ce6b595f.js";import{j as B,i as F,k as j,T as R,l as _,m as G}from"./translations-ec3d068b.js";import{a as I,b as L,c as N,d as z,e as U,f as P,g as q,h as Q}from"./translation-6fe02956.js";import{e as Y}from"./translations-ddb9364f.js";import"./checked-input-element-c27a5688.js";import"./faceplate-input-2a2c1f51.js";import"./input-element-e9f4def4.js";import"./form-common-utils-8fdfcdc2.js";import"./constants-3ee6bdfd.js";import"./live-95c03d16.js";import"./text-input-880d1fa2.js";import"./icon-checkmark-e734b457.js";import"./params-b8446fa9.js";var K;!function(t){t.GREAT="great",t.NOT_GREAT="not great"}(K||(K={}));let W=class extends(m(l)){constructor(){super(...arguments),this.otherReasonFormValue="",this.isOpen=!1,this.handleDismiss=()=>{this.trackEvent(B()),this.close()}}show(){this.trackEvent(F()),this.faceplateDialog?.showModal?.(),this.isOpen=!0}close(){this.faceplateDialog?.close?.(),this.isOpen=!1,this.selectedOption=void 0,this.otherReasonFormValue=""}showThankYouAlert(){this.dispatchEvent(k("faceplate-alert",{level:v.success,message:"Thanks for rating"}))}handleUpvoteTranslation(){this.selectedOption=K.GREAT}handleDownvoteTranslation(){this.selectedOption=K.NOT_GREAT}handleSubmit(){this.selectedOption&&(this.trackEvent(j({reason:this.selectedOption,survey_text:this.otherReasonFormValue})),this.showThankYouAlert(),this.close())}render(){return t`\n <faceplate-dialog \n id="global-translation-feedback-faceplate-dialog" \n class="translation-feedback" \n>\n <div class="flex flex-col gap-lg">\n <div class="flex justify-between">\n <h3 class="font-bold text-24 text-neutral-content-strong m-0" data-testid="modal-title">\n Enjoying these translations?\n </h3>\n ${b({attributes:{onclick:this.handleDismiss},appearance:"secondary",leadingIcon:e({size:a.Medium}),size:f.Medium})}\n </div>\n <p class="m-0" data-testid="modal-subtitle">\n Tell us what you think about your translated Reddit experience.\n </p>\n <div class="flex justify-center gap-md">\n <button \n data-testid="upvote-translation" \n class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===K.GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" \n @click="${this.handleUpvoteTranslation}" \n @keydown="${this.handleUpvoteTranslation}" \n>\n <img \n src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Smile_EyesOpen.png" \n class="block m-auto pb-xs" \n width="56" \n height="56" \n alt="" \n>\n <p class="font-semibold text-14 text-center text-neutral-content-strong m-0">\n Great\n </p>\n </button>\n <button \n data-testid="downvote-translation" \n class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===K.NOT_GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" \n @click="${this.handleDownvoteTranslation}" \n @keydown="${this.handleDownvoteTranslation}" \n>\n <img \n src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Blanc.png" \n class="block m-auto pb-xs" \n width="56" \n height="56" \n alt="" \n>\n <p class="font-semibold text-14 text-center text-neutral-content-strong m-0">\n Not Great\n </p>\n </button>\n </div>\n ${this.selectedOption?t`\n <div class="flex w-full box-border">\n <faceplate-textarea-input \n data-testid="other-reason-input" \n maxlength="500" \n appearance="${V.BORDERED}" \n size="${O.EXPANDED}" \n @keyup="${t=>{t.stopPropagation(),this.otherReasonFormValue=t.target.value}}" \n class="w-full" \n .value="${this.otherReasonFormValue}" \n>\n <span slot="label" \n>Leave a comment (optional)</span>\n </faceplate-textarea-input>\n </div>\n `:t``}\n <div class="flex justify-end">\n ${b({appearance:"primary",size:f.Large,shape:"pill",attributes:{onclick:this.handleSubmit,className:"flex box-border","data-testid":"submit-feedback-button",disabled:!this.selectedOption},children:t`<span class="font-semibold text-14" \n>Give Feedback</span>`})}\n </div>\n </div>\n </faceplate-dialog>\n `}};W.styles=[n`.translation-feedback{border-radius:16px;max-width:400px;padding:2rem 1.5rem 1.5rem 1.5rem;width:82%}`,g],i([s("#global-translation-feedback-faceplate-dialog")],W.prototype,"faceplateDialog",void 0),i([o()],W.prototype,"selectedOption",void 0),i([o()],W.prototype,"otherReasonFormValue",void 0),i([o()],W.prototype,"isOpen",void 0),W=i([r("global-translation-feedback-modal")],W);const X="reddit-cookie-banner",H="shreddit-experience-tree",J="faceplate-bottom-sheet",Z='shreddit-async-loader[bundlename="desktop_rpl_nsfw_blocking_modal"], shreddit-async-loader[bundlename="nsfw_blocking_modal"]',tt=m(l);function et(t){const e=t?.shadowRoot?.querySelector(J);return!!e?.open}let at=class extends tt{constructor(){super(...arguments),this.isDesktop=!1,this.withFeedback=!1,this.translationContextValue=x,this.withCoachmark=!1,this.hasCoachmarkDisplayLimit=!1,this.translationActiveMsg="Translations enabled",this.handleTranslationActiveSwitch=()=>{const t=!this.translationContextValue.isTranslationActive;this.dispatchContextUpdateEvent({isTranslationActive:t})},this.closeTranslationCoachmark=()=>{this.translationCoachmark?.close?.(),this.onCoachmarkClose()},this.openTranslationCoachmark=()=>{this.trackEvent(I(!!this.translationContextValue.isTranslationActive)),this.translationCoachmark?.show?.()},this.openTranslationMenu=()=>{this.trackEvent(L(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.show?.():this.translationMenuBottomSheet?.showModal?.()},this.closeTranslationMenu=()=>{this.trackEvent(L(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.close?.():this.translationMenuBottomSheet?.close?.()},this.openFeedbackModal=()=>{this.translationFeedbackModal?.show?.()},this.handleCoachmarkSettingsClick=()=>{this.closeTranslationCoachmark(),this.openTranslationMenu(),this.trackEvent(N(z.UpdateSettings))},this.handleTranslationActiveClick=t=>{t.stopPropagation(),this.trackEvent(U(!!this.translationContextValue.isTranslationActive))},this.handleTooltipClick=t=>{t.stopPropagation()},this.handleCoachmarkCloseClick=()=>{this.closeTranslationCoachmark(),this.trackEvent(N(z.Dismiss))},this.handleNavMobileButtonClick=()=>{this.openTranslationMenu(),this.trackEvent(P(!!this.translationContextValue.isTranslationActive))},this.handleNavbarButtonClick=()=>{this.trackEvent(P(!!this.translationContextValue.isTranslationActive)),this.trackEvent(L(!!this.translationContextValue.isTranslationActive))},this.handleNavigationButtonClose=t=>{t.stopPropagation(),this.trackEvent(q(!!this.translationContextValue.isTranslationActive))},this.handleGiveFeedbackButtonClick=()=>{this.openFeedbackModal(),this.closeTranslationMenu()},this.onCoachmarkClose=()=>{setTimeout((()=>{this.dispatchContextUpdateEvent({shouldDisplayCoachmark:!1,shouldDisplayFeedbackCoachmark:!0})}),500)}}updated(t){this.withCoachmark&&!this.hasCoachmarkDisplayLimit&&t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&this.displayCoachmark()}displayCoachmark(){const{coachmarkDisplayCount:t,shouldDisplayCoachmark:e}=this.translationContextValue;window.setTimeout((()=>{if(!e)return;if(this.hasCoachmarkObstacles())return;const a=t<1;this.dispatchContextUpdateEvent({coachmarkDisplayCount:t+1,shouldDisplayCoachmark:a,shouldDisplayFeedbackCoachmark:!a}),a&&this.openTranslationCoachmark(),this.hasCoachmarkDisplayLimit=!0}),1500)}hasCoachmarkObstacles(){const t=!!document.querySelector(X),e=document.querySelector(H);let a=[];e&&(a=T(et,e));const n=!!document.querySelector(Z);return t||a?.length>0||n}dispatchContextUpdateEvent(t){const e={...this.translationContextValue,...t},a=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:e});this.dispatchEvent(a)}renderCoachmark(){return this.translationContextValue.shouldDisplayCoachmark?t`<div class="flex flex-col">\n <div class="flex flex-row flex-nowrap items-start">\n <div class="flex-shrink flex-grow-0 pt-xs pl-xs mr-xs">\n ${d({size:a.Small})}\n </div>\n <div class="flex flex-col flex-grow flex-shrink-0 pt-xs items-start">\n <h3 class="mt-0 text-14">${this.translationActiveMsg}</h3>\n <p class="mt-0 max-w-[10rem] xs:max-w-none">\n ${this.translationContextValue.isTranslationActive?"Posts and comments are automatically translated":"Automatically translate posts and comments"}\n </p>\n </div>\n <div class="flex-shrink flex-grow-0">\n ${b({size:f.Medium,appearance:"plainInverted",shape:"pill",leadingIcon:e({size:a.Small}),attributes:{"aria-label":"Close",id:"coachmark-close-button",onclick:this.handleCoachmarkCloseClick}})}\n </div>\n </div>\n <div class="flex flex-nowrap gap-xs justify-end">\n ${b({children:"Settings",size:f.Medium,appearance:"plainInverted",shape:"pill",attributes:{id:"coachmark-settings-button",onclick:this.handleCoachmarkSettingsClick}})}\n </div>\n </div>`:t``}renderDesktopMenu(){return t`<faceplate-dropdown-menu \n position="bottom-end" \n id="translation-desktop-menu" \n .onclose="${this.handleNavigationButtonClose}" \n>\n ${b({size:f.Medium,appearance:"plain",shape:"pill",leadingIcon:h({size:a.Medium}),attributes:{id:"translation-menu-button","aria-label":this.translationActiveMsg,onclick:this.handleNavbarButtonClick}})}\n <faceplate-menu slot="menu" dropdown>\n ${$({label:t`\n <faceplate-switch-input \n id="hui-translation-switch" \n appearance="${u.PRIMARY}" \n class="inline-flex flex-row-reverse gap-sm" \n ?checked="${this.translationContextValue.isTranslationActive}" \n @input="${this.handleTranslationActiveSwitch}" \n @click="${this.handleTranslationActiveClick}" \n>\n <span class="-ml-xs">${this.translationActiveMsg}</span>\n </faceplate-switch-input>\n `,size:D.Medium})}\n ${this.withFeedback?$({label:"Give translation feedback",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:D.Medium,onClick:this.handleGiveFeedbackButtonClick}):p}\n </faceplate-menu>\n </faceplate-dropdown-menu>`}renderMobileMenu(){return t`<div>\n ${b({size:f.Medium,appearance:"plain",shape:"pill",leadingIcon:h({size:a.Medium}),attributes:{id:"translation-menu-button",onclick:this.handleNavMobileButtonClick,"aria-label":this.translationActiveMsg}})}\n <faceplate-bottom-sheet \n id="translation-mobile-menu" \n @faceplate-close="${this.handleNavigationButtonClose}" \n>\n <div class="p-md flex flex-col items-stretch w-full gap-md">\n <faceplate-switch-input \n id="hui-translation-switch" \n appearance="${u.PRIMARY}" \n class="flex flex-row-reverse justify-between gap-sm px-xs" \n ?checked="${this.translationContextValue.isTranslationActive}" \n @input="${this.handleTranslationActiveSwitch}" \n @click="${this.handleTranslationActiveClick}" \n>\n <span class="inline-flex items-center gap-xs">\n ${h({size:a.Medium})}\n <span> ${this.translationActiveMsg} </span>\n </span>\n </faceplate-switch-input>\n ${this.withFeedback?$({label:"Give translation feedback",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:D.Medium,onClick:this.handleGiveFeedbackButtonClick}):p}\n </div>\n </faceplate-bottom-sheet>\n </div>`}render(){return t`\n <faceplate-tooltip \n position="${this.isDesktop?"bottom-end":"bottom"}" \n appearance="inverted" \n id="translation-coachmark-tooltip" \n trigger-event="none" \n @click="${this.handleTooltipClick}" \n @faceplate-tooltip:closed="${this.onCoachmarkClose}" \n>\n <div slot="trigger">\n ${this.isDesktop?this.renderDesktopMenu():this.renderMobileMenu()}\n </div>\n ${this.renderCoachmark()}\n </faceplate-tooltip>\n ${this.withFeedback?t` <global-translation-feedback-modal \n id="hui-translation-button-feedback-modal" \n></global-translation-feedback-modal>`:p}\n `}};at.styles=[g],i([c({type:Boolean,attribute:"is-desktop"})],at.prototype,"isDesktop",void 0),i([c({type:Boolean,attribute:"with-feedback"})],at.prototype,"withFeedback",void 0),i([C({context:w,subscribe:!0}),o()],at.prototype,"translationContextValue",void 0),i([c({type:Boolean,attribute:"with-coachmark"})],at.prototype,"withCoachmark",void 0),i([o()],at.prototype,"hasCoachmarkDisplayLimit",void 0),i([s("#translation-coachmark-tooltip")],at.prototype,"translationCoachmark",void 0),i([s("#translation-desktop-menu")],at.prototype,"translationDropdownMenu",void 0),i([s("#translation-mobile-menu")],at.prototype,"translationMenuBottomSheet",void 0),i([s("#hui-translation-button-feedback-modal")],at.prototype,"translationFeedbackModal",void 0),at=i([r("hui-translation-button")],at);let nt=class extends(m(l)){constructor(){super(...arguments),this.translationContextValue=x,this.isNewAccountAge=!1,this.isRegularSEOVisit=!1,this.isMTSEOVisit=!1,this.withBackendSetting=!1,this.settingsLoaded=!1,this.requestClientGQL=y}connectedCallback(){super.connectedCallback(),this.initializeTranslationSettings()}updated(t){if(!t.has("translationContextValue")||!this.withBackendSetting)return;const e=t.get("translationContextValue"),a=this.translationContextValue.isTranslationActive,n=e?.isTranslationActive;if(void 0===n)return;(!0!==n&&!0===a||!1!==n&&!1===a)&&this.saveTranslationSettingInAccount(a)}async initializeTranslationSettings(){const t=this.fetchTranslationSettingFromCookie(),e=await this.fetchTranslationSettingFromGQL();let a=R.DEFAULT_OFF,n={...this.translationContextValue};if(t&&(n={...n,...t},a=R.COOKIE),null!==e&&(n={...n,isTranslationActive:e},a=R.BACKEND),null===t&&null===e){let t=!1;this.isMTSEOVisit?(a=R.MT_SEO,t=!0):this.isRegularSEOVisit?a=R.REGULAR_SEO:this.isNewAccountAge&&(a=R.ACCOUNT_AGE,t=!0),n={...n,isTranslationActive:t}}this.settingsLoaded=!0,this.dispatchContextUpdateEvent(n),null===e&&void 0!==n.isTranslationActive&&this.saveTranslationSettingInAccount(n.isTranslationActive),this.trackEvent(Q(!!n.isTranslationActive)),a&&(n.isTranslationActive?this.trackEvent(_(a)):this.trackEvent(G(a)))}fetchTranslationSettingFromCookie(){const t=A.get(E)??"";return Y(t)}async fetchTranslationSettingFromGQL(){if(!this.withBackendSetting)return null;try{const{data:t}=await this.requestClientGQL({operation:M.IdentityImmersiveTranslationSetting}),e=t.identity?.preferences?.isMachineTranslationImmersive;return null==e||e===S.Unset?null:e===S.Enabled}catch{}return null}async saveTranslationSettingInAccount(t){if(!this.withBackendSetting||!this.settingsLoaded)return null;try{await this.requestClientGQL({operation:M.UpdateAccountPreferences,variables:{input:{isMachineTranslationImmersive:t?S.Enabled:S.Disabled}}})}catch{}return null}dispatchContextUpdateEvent(t){const e=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(e)}render(){return this.settingsLoaded?t`<div>\n <slot></slot>\n </div>`:p}};i([C({context:w,subscribe:!0}),o()],nt.prototype,"translationContextValue",void 0),i([c({type:Boolean,attribute:"is-new-account-age"})],nt.prototype,"isNewAccountAge",void 0),i([c({type:Boolean,attribute:"is-regular-seo-visit"})],nt.prototype,"isRegularSEOVisit",void 0),i([c({type:Boolean,attribute:"is-mt-seo-visit"})],nt.prototype,"isMTSEOVisit",void 0),i([c({type:Boolean,attribute:"with-backend-setting"})],nt.prototype,"withBackendSetting",void 0),i([o()],nt.prototype,"settingsLoaded",void 0),nt=i([r("translation-settings-admin")],nt);
//# sourceMappingURL=hui-translation-button-client-js-94c81d04.js.map
